<div class="space-y-6">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
        <h2 class="text-2xl font-bold text-slate-800">Gestión de Empleados</h2>
        <button (click)="openModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 flex items-center w-full sm:w-auto justify-center">
            <i class="pi pi-plus mr-2"></i>
            Añadir Empleado
        </button>
    </div>

    <div class="bg-white p-4 rounded-lg shadow-sm">
        <div class="relative w-full sm:w-1/3">
            <i class="pi pi-search absolute top-1/2 left-3 -translate-y-1/2 text-slate-400"></i>
            <input
                    type="text"
                    [ngModel]="searchTerm()"
                    (input)="onSearch($any($event.target).value)"
                    placeholder="Buscar por nombre, email..."
                    class="w-full bg-white pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
        </div>
    </div>

    <div class="bg-white shadow-lg rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-slate-500">
                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                <tr>
                    <th scope="col" class="px-6 py-3">Nombre</th>
                    <th scope="col" class="px-6 py-3">Email</th>
                    <th scope="col" class="px-6 py-3">Teléfono</th>
                    <th scope="col" class="px-6 py-3">Acciones</th>
                </tr>
                </thead>
                <tbody>
                    @for (employee of employees(); track employee.id) {
                        <tr class="bg-white border-b hover:bg-slate-50">
                            <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">
                                {{ employee.firstName | titlecase }} {{ employee.lastName | titlecase }}
                            </td>
                            <td class="px-6 py-4 text-slate-600">
                                {{ employee.email || 'N/A' }}
                            </td>
                            <td class="px-6 py-4 text-slate-600">
                                {{ employee.phone || 'N/A' }}
                            </td>
                            <td class="px-6 py-4 flex items-center gap-4">
                                <button (click)="openModal(employee)" class="font-medium text-indigo-600 hover:text-indigo-800 transition-colors">
                                    Editar
                                </button>
                                <button (click)="deleteEmployee(employee.id)" class="font-medium text-red-600 hover:text-red-800 transition-colors">
                                    Eliminar
                                </button>
                            </td>
                        </tr>
                    } @empty {
                        <tr class="bg-white border-b">
                            <td colspan="5" class="px-6 py-4 text-center text-slate-500">
                                @if (searchTerm()) {
                                    No se encontraron empleados que coincidan con "{{ searchTerm() }}".
                                } @else {
                                    No se encontraron empleados.
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (totalPages() > 1) {
            <div class="flex items-center justify-between border-t border-slate-200 bg-white px-4 py-3 sm:px-6">
                <div class="flex-1 flex justify-between items-center">
                    <p class="text-sm text-slate-700">
                        Página <span class="font-medium">{{ currentPage() }}</span> de <span class="font-medium">{{ totalPages() }}</span>
                    </p>
                    <div class="flex gap-2">
                        <button
                                (click)="previousPage()"
                                [disabled]="currentPage() === 1"
                                class="relative inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-slate-900 ring-1 ring-inset ring-slate-300 hover:bg-slate-50 focus-visible:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed">
                            Anterior
                        </button>
                        <button
                                (click)="nextPage()"
                                [disabled]="currentPage() === totalPages()"
                                class="relative inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-slate-900 ring-1 ring-inset ring-slate-300 hover:bg-slate-50 focus-visible:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed">
                            Siguiente
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@if (isModalOpen()) {
    <div class="fixed inset-0 bg-black bg-opacity-60 z-40 flex items-center justify-center p-4">
        <div (click)="$event.stopPropagation()" class="bg-white rounded-xl shadow-2xl w-full max-w-lg transform transition-all"
             role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <form (ngSubmit)="saveEmployee()">
                <div class="flex justify-between items-center border-b p-5">
                    <h3 id="modal-title" class="text-xl font-bold text-slate-800">
                        @if(editMode()) {
                            Editar Empleado
                        } @else {
                            Agregar Nuevo Empleado
                        }
                    </h3>
                    <button (click)="closeModal()" type="button" class="text-slate-400 hover:text-slate-600">
                        <i class="pi pi-times text-xl"></i>
                    </button>
                </div>

                <div class="p-6 space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label for="firstName" class="block text-sm font-medium text-slate-700 mb-1">Nombre</label>
                            <input id="firstName"
                                   [ngModel]="firstName()" (ngModelChange)="firstName.set($event)"
                                   name="firstName" type="text" class="w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                        <div>
                            <label for="lastName" class="block text-sm font-medium text-slate-700 mb-1">Apellido</label>
                            <input id="lastName"
                                   [ngModel]="lastName()" (ngModelChange)="lastName.set($event)"
                                   name="lastName" type="text" class="w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-slate-700 mb-1">Email</label>
                        <input id="email"
                               [ngModel]="email()" (ngModelChange)="email.set($event)"
                               (input)="generateUsername()"
                               name="email" type="email"
                               class="w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                        <p class="text-xs text-slate-400 mt-1">El nombre de usuario se generará automáticamente desde el email.</p>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-slate-700 mb-1">Teléfono (Opcional)</label>
                        <input id="phone"
                               [ngModel]="phone()" (ngModelChange)="phone.set($event)"
                               name="phone" type="tel" class="w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>

                    <div>
                        <label for="shift" class="block text-sm font-medium text-slate-700 mb-1">
                            Turno de Trabajo <span class="text-red-500">*</span>
                        </label>
                        <select id="shift"
                                [ngModel]="selectedShiftId()"
                                (ngModelChange)="selectedShiftId.set($event)"
                                name="shift"
                                required
                                class="w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 py-2 px-3 bg-white">

                            <option [value]="null" disabled>-- Seleccionar Turno --</option>

                            @for (shift of availableShifts(); track shift.id) {
                                <option [value]="shift.id">
                                    {{ shift.name }} ({{ shift.startTime }} - {{ shift.endTime }})
                                </option>
                            }
                        </select>
                        @if (!selectedShiftId() && confirmAction()) { <p class="text-xs text-red-500 mt-1">Debes asignar un turno.</p>
                        }
                    </div>

                    <div class="pt-5 border-t border-slate-200">
                        <div class="flex justify-between items-center mb-1">
                            <h4 class="text-md font-semibold text-slate-700">Credenciales de Acceso</h4>
                            <button (click)="generatePassword()" type="button" class="text-sm font-medium text-indigo-600 hover:underline flex items-center">
                                <i class="pi pi-refresh mr-1 text-xs"></i>
                                Generar Nuevas
                            </button>
                        </div>
                        <p class="text-sm text-slate-500 mb-4">Estas son las credenciales para que el empleado acceda a su portal.</p>
                        <div class="space-y-4">
                            <div>
                                <label for="username" class="block text-sm font-medium text-slate-600">Usuario (Generado del Email)</label>
                                <div class="relative mt-1">
                                    <input id="username" readonly [value]="username()" class="w-full bg-slate-100 border-slate-300 rounded-md shadow-sm pr-10">
                                    <button (click)="copyToClipboard(username(), 'username')" type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-500 hover:text-indigo-600">
                                        <i class="pi" [class]="copiedField() === 'username' ? 'pi-check text-green-500' : 'pi-copy'"></i>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label for="password" class="block text-sm font-medium text-slate-600">Contraseña</label>
                                <div class="relative mt-1">
                                    <input id="password" readonly [value]="password()" class="w-full bg-slate-100 border-slate-300 rounded-md shadow-sm pr-10">
                                    <button (click)="copyToClipboard(password(), 'password')" type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-500 hover:text-indigo-600">
                                        <i class="pi" [class]="copiedField() === 'password' ? 'pi-check text-green-500' : 'pi-copy'"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end items-center gap-3 bg-slate-50 p-5 rounded-b-xl">
                    <button (click)="closeModal()" type="button" class="bg-white hover:bg-slate-100 text-slate-700 font-semibold py-2 px-4 border border-slate-300 rounded-lg transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        @if (editMode()) {
                            Guardar Cambios
                        } @else {
                            Crear Empleado
                        }
                    </button>
                </div>
            </form>
        </div>
    </div>
}

@if (isConfirmModalOpen()) {
    <div class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div (click)="$event.stopPropagation()" class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all overflow-hidden"
             role="dialog" aria-modal="true" aria-labelledby="confirm-modal-title">

            <div class="flex justify-between items-start border-b border-slate-100 p-6">
                <h3 id="confirm-modal-title" class="text-xl font-bold text-slate-800">
                    Confirmar Operación
                </h3>
                <button (click)="closeConfirmModal()" type="button" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <i class="pi pi-times text-xl"></i>
                </button>
            </div>

            <div class="p-6">
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center rounded-full bg-indigo-100">
                        <i class="pi pi-info-circle text-2xl text-indigo-600"></i>
                    </div>
                    <div class="ml-4">
                        <h4 class="text-lg font-bold text-slate-900">
                            @if(editMode()) {
                                ¿Guardar cambios?
                            } @else {
                                ¿Crear nuevo empleado?
                            }
                        </h4>
                        <p class="mt-2 text-slate-600 leading-relaxed">
                            @if(editMode()) {
                                Estás a punto de actualizar la información de <strong>{{ firstName() }} {{ lastName() }}</strong>.
                            } @else {
                                Estás a punto de registrar un nuevo empleado en el sistema.
                            }
                            Verifica que los datos sean correctos.
                        </p>
                    </div>
                </div>
            </div>

            <div class="flex justify-end items-center gap-3 bg-slate-50 p-6 border-t border-slate-100">
                <button (click)="closeConfirmModal()" type="button" class="bg-white hover:bg-slate-100 text-slate-700 font-semibold py-2.5 px-5 border border-slate-300 rounded-xl transition-colors">
                    Revisar
                </button>

                <button (click)="executeSave()" type="button" [disabled]="isLoading()" class="bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white font-bold py-2.5 px-5 rounded-xl shadow-lg shadow-indigo-200 transition-all flex items-center">
                    @if(isLoading()) { <i class="pi pi-spin pi-spinner mr-2"></i> }
                    @if(editMode()) {
                        Sí, Actualizar
                    } @else {
                        Sí, Crear
                    }
                </button>
            </div>
        </div>
    </div>
}

@if (isDeleteModalOpen()) {
    <div class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div (click)="$event.stopPropagation()" class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all overflow-hidden"
             role="dialog" aria-modal="true" aria-labelledby="delete-modal-title">

            <div class="flex justify-between items-start border-b border-slate-100 p-6">
                <h3 id="delete-modal-title" class="text-xl font-bold text-slate-800">
                    Confirmar Eliminación
                </h3>
                <button (click)="closeDeleteModal()" type="button" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <i class="pi pi-times text-xl"></i>
                </button>
            </div>

            <div class="p-6">
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center rounded-full bg-red-100">
                        <i class="pi pi-exclamation-triangle text-2xl text-red-600"></i>
                    </div>
                    <div class="ml-4">
                        <h4 class="text-lg font-bold text-slate-900">¿Eliminar empleado?</h4>
                        <p class="mt-2 text-slate-600 leading-relaxed">
                            Estás a punto de eliminar este registro permanentemente. El empleado perderá el acceso al sistema inmediatamente.
                        </p>
                        <p class="mt-2 text-sm font-semibold text-slate-700">
                            Esta acción no se puede deshacer.
                        </p>
                    </div>
                </div>
            </div>

            <div class="flex justify-end items-center gap-3 bg-slate-50 p-6 border-t border-slate-100">
                <button (click)="closeDeleteModal()" type="button" class="bg-white hover:bg-slate-100 text-slate-700 font-semibold py-2.5 px-5 border border-slate-300 rounded-xl transition-colors">
                    Cancelar
                </button>

                <button (click)="confirmDelete()" type="button" [disabled]="isLoading()" class="bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white font-bold py-2.5 px-5 rounded-xl shadow-lg shadow-red-200 transition-all flex items-center">
                    @if(isLoading()) { <i class="pi pi-spin pi-spinner mr-2"></i> }
                    Sí, Eliminar
                </button>
            </div>
        </div>
    </div>
}
