<div class="space-y-8">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4 print-hide">
        <div>
            <h2 class="text-3xl font-bold text-slate-800">Generador de Código QR</h2>
            <p class="text-slate-500 mt-2 text-lg">Gestiona el código QR para el control de acceso.</p>
        </div>

        <div class="flex items-center gap-3 w-full sm:w-auto">
            <button (click)="openModal()" class="bg-white hover:bg-slate-50 text-slate-700 font-medium py-2.5 px-5 border border-slate-200 rounded-xl shadow-sm transition-all flex items-center justify-center flex-1 sm:flex-initial">
                <i class="pi pi-pencil mr-2"></i>
                Editar
            </button>
            <button (click)="regenerateId()" class="bg-white hover:bg-slate-50 text-amber-600 font-medium py-2.5 px-5 border border-slate-200 rounded-xl shadow-sm transition-all flex items-center justify-center flex-1 sm:flex-initial">
                <i class="pi pi-refresh mr-2"></i>
                Regenerar
            </button>
            <button (click)="downloadPdf()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 px-5 rounded-xl shadow-md shadow-indigo-200 transition-all flex items-center justify-center flex-1 sm:flex-initial">
                <i class="pi pi-download mr-2"></i>
                Descargar PDF
            </button>
        </div>
    </div>

    <div class="flex justify-center py-10 bg-slate-50 rounded-2xl border border-slate-200 print:bg-white print:border-none print:p-0">

        <div id="qr-code-printable-area" class="bg-white rounded-xl shadow-xl p-12 flex flex-col items-center text-center border border-slate-100 w-full max-w-2xl print:shadow-none print:border-none print:w-full print:max-w-none print:p-4">

            <h3 class="text-5xl font-extrabold text-slate-900 tracking-tight mb-4">{{ qrCode().name }}</h3>

            <p class="text-slate-500 font-medium text-lg mb-8">Escanea este código para registrar tu asistencia</p>

            <div class="p-4 bg-white border-4 border-slate-900 rounded-3xl mb-10 shadow-sm">
                <canvas id="qr-canvas-main"></canvas>
            </div>

            <div class="w-full border-t-2 border-dashed border-slate-200 pt-8 mt-4">
                <div class="flex items-center justify-center gap-3 text-slate-500 mb-2">
                    <i class="pi pi-camera text-2xl"></i>
                    <span class="text-base font-semibold uppercase tracking-wider">Abre la cámara de tu celular</span>
                </div>
                <p class="text-sm text-slate-400">Sistema gestionado por <span class="font-bold text-slate-500">AsistenciaPro</span></p>
            </div>

        </div>
    </div>
</div>

@if (isModalOpen()) {
    <div class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div (click)="$event.stopPropagation()" class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all overflow-hidden"
             role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <form (ngSubmit)="saveQrCode()">
                <div class="flex justify-between items-center border-b border-slate-100 p-6">
                    <h3 id="modal-title" class="text-xl font-bold text-slate-800">
                        Editar Nombre del QR
                    </h3>
                    <button (click)="closeModal()" type="button" class="text-slate-400 hover:text-slate-600 transition-colors">
                        <i class="pi pi-times text-xl"></i>
                    </button>
                </div>

                <div class="p-6 space-y-4">
                    <div>
                        <label for="qrName" class="block text-sm font-semibold text-slate-700 mb-2">Nombre visible</label>
                        <input id="qrName" [(ngModel)]="qrCodeName" name="qrName" type="text"
                               class="w-full px-4 py-3 border border-slate-300 rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                               placeholder="Ej: Entrada Principal" required>
                        <p class="text-xs text-slate-500 mt-2">Este nombre aparecerá en grande sobre el código QR.</p>
                    </div>
                </div>

                <div class="flex justify-end items-center gap-3 bg-slate-50 p-6 border-t border-slate-100">
                    <button (click)="closeModal()" type="button" class="bg-white hover:bg-slate-100 text-slate-700 font-semibold py-2.5 px-5 border border-slate-300 rounded-xl transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" [disabled]="isLoading()" class="bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white font-bold py-2.5 px-5 rounded-xl shadow-lg shadow-indigo-200 transition-all flex items-center">
                        @if(isLoading()) { <i class="pi pi-spin pi-spinner mr-2"></i> }
                        Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
}

@if (isRegenerateModalOpen()) {
    <div class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div (click)="$event.stopPropagation()" class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all overflow-hidden"
             role="dialog" aria-modal="true" aria-labelledby="regenerate-modal-title">

            <div class="flex justify-between items-start border-b border-slate-100 p-6">
                <h3 id="regenerate-modal-title" class="text-xl font-bold text-slate-800">
                    Confirmar Regeneración
                </h3>
                <button (click)="closeRegenerateModal()" type="button" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <i class="pi pi-times text-xl"></i>
                </button>
            </div>

            <div class="p-6">
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center rounded-full bg-red-100">
                        <i class="pi pi-exclamation-triangle text-2xl text-red-600"></i>
                    </div>
                    <div class="ml-4">
                        <h4 class="text-lg font-bold text-slate-900">¿Estás seguro?</h4>
                        <p class="mt-2 text-slate-600 leading-relaxed">
                            Estás a punto de regenerar el código QR. El código actual será <strong>invalidado permanentemente</strong> y dejará de funcionar para todos los empleados.
                        </p>
                    </div>
                </div>
            </div>

            <div class="flex justify-end items-center gap-3 bg-slate-50 p-6 border-t border-slate-100">
                <button (click)="closeRegenerateModal()" type="button" class="bg-white hover:bg-slate-100 text-slate-700 font-semibold py-2.5 px-5 border border-slate-300 rounded-xl transition-colors">
                    Cancelar
                </button>
                <button (click)="confirmRegenerate()" type="button" [disabled]="isLoading()" class="bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white font-bold py-2.5 px-5 rounded-xl shadow-lg shadow-red-200 transition-all flex items-center">
                    @if(isLoading()) { <i class="pi pi-spin pi-spinner mr-2"></i> }
                    Sí, Regenerar
                </button>
            </div>
        </div>
    </div>
}
